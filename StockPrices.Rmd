---
title: "Stock Prices"
author: "Jess Kaminsky, Blain Morin"
date: "February 6, 2018"
output: pdf_document
---

```{r}
library(XML)
library(httr)
library(RCurl)

link = "http://en.wikipedia.org/wiki/S%26P_100"
doc <- readHTMLTable(rawToChar(GET(link)$content))

stock_table <- doc[[3]]
stock_table$Symbol <- as.character(stock_table$Symbol)
stock_table$Symbol[17] <-"BRK-B"

symbol_names <- stock_table$Symbol

<<<<<<< HEAD
getYahooQuote <- function(symbol="xom") {
    theurl <- paste0("https://finance.yahoo.com/quote/", symbol, "?p=", symbol)
    ## better formatting
    aa = getURL(theurl)
    aa <- readLines(tc <- textConnection(aa)); close(tc)
    
    ## check chrome or safari or firefox for patterns
    bb =(  strsplit(as.character(aa[5]), ">") ) 
    
    ## find price: the next line after "react-text: 36 is" is the current price
    pricetxt <- bb[[1]][grep("react-text: 36", bb[[1]])+1]
    
    ## get numeric price
    as.numeric( strsplit( pricetxt, "<")[[1]][1] ) 
  }
=======
## Try the standard way for downloading webpages 
theurl <- "https://finance.yahoo.com/quote/XOM/history?p=XOM"
a <- getURL(theurl)
a <- readLines(tc <- textConnection(a)); close(tc)
fileConn<-file("output.html") # no download data button
writeLines(a, fileConn)
close(fileConn)


## R Selenium
library(RSelenium)
rs <- rsDriver(extraCapabilities = list(
    chromeOptions = 
        list(prefs = list(
            "profile.default_content_settings.popups" = 0L,
            "download.prompt_for_download" = FALSE,
            "download.default_directory" = "/Users/xluo/Downloads"
        )
        )
))
rsc <- rs$client
rsc$navigate("https://finance.yahoo.com/quote/XOM/history?p=XOM")
hpcsv <- rsc$findElement("xpath", "//a[contains(@download, 'csv')]")
hpcsv$clickElement()



downloadHPYahoo <- function(symbol) {
    Sys.sleep(10+runif(1)*20)
    rsc$navigate(paste0("https://finance.yahoo.com/quote/", symbol, "/history?p=", symbol))
    hpcsv <- rsc$findElement("xpath", "//a[contains(@download, 'csv')]")
    hpcsv$clickElement()
}
>>>>>>> 5e3c9af06dcb5a65948803de68218b0991206df4

for (s in stock_table) {
    downloadHPYahoo(s)
}

<<<<<<< HEAD

getYahooQuote(symbol = symbol_names[1])
=======
>>>>>>> 5e3c9af06dcb5a65948803de68218b0991206df4
```
